{% extends "base.html" %}

{% block title %} Charts {% endblock %}
{% block meta %}
{% include "meta.html" %}
{% endblock %}
{% block content %}
<h3>Charts</h3>
<div class="container">
  {# https://jinja.palletsprojects.com/en/3.0.x/templates/#whitespace-control #}
  <div>
    <canvas id="myChart"></canvas>
  </div>
</div>
{% endblock %}

{% block javascript %}  
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
<script>
  var data = get_json();

  function get_json() {
    data = []
    $.getJSON("/quotes/1", function (json) {
      
      json.forEach(function(el) {

        //quote = {x: luxon.DateTime.fromRFC2822(el[0]), y: el[1]};
        quote = {x: el[0], y: el[1]};
        data.push(quote);

      });
    });
    return data;
  }

  const actions = [
    {
      name: 'Update',
      handler(chart) {
        chart.data.datasets[0].data = get_json();
        chart.update();
      }
    },
  ];

  //setTimeout(function(){ window.location.reload(); }, 10000);
  const ctx = document.getElementById('myChart');
  

  const cfg = {
    type: 'line',
    data: {
      datasets: [{
        data: data
      }]
    },
    options: {
      plugins: {
        title: {
          text: 'Fund Quotes',
          display: true
        },
        zoom: {
          pan: {
            enabled: true
          },
          zoom: {
            wheel: {
              enabled: true,
            },
            pinch: {
              enabled: true
            },
            mode: 'xy',
          }
        }
      },
      scales: {
        x: {
          type: 'time',
          ticks: {
            autoSkip: true,
            //autoSkipPadding: 50,
            maxRotation: 0
          },
          time: {
            unit: 'day',
            displayFormats: {
              day: 'd M y',
            }
          },
          title: {
            display: true,
            text: 'Date'
          }
        },
        y: {
          title: {
            display: true,
            text: 'value'
          }
        }
      },
    }
  }

  new Chart(ctx, cfg);
</script>
{% endblock %}